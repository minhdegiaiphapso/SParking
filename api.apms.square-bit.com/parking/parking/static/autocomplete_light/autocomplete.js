/**
 * Created by nghia on 3/11/15.
 */
void 0==window.yourlabs&&(window.yourlabs={});void 0!=window.yourlabs.Autocomplete&&console.log("WARNING ! You are loading autocomplete.js **again**.");yourlabs.getInternetExplorerVersion=function(){var a=-1;"Microsoft Internet Explorer"==navigator.appName&&null!=/MSIE ([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$1));return a};
$.fn.yourlabsRegistry=function(a,b){var c=yourlabs.getInternetExplorerVersion();if(-1==c||8<c)return void 0===b?this.data(a):this.data(a,b);void 0==$.fn.yourlabsRegistry.data&&($.fn.yourlabsRegistry.data={});void 0==$.fn.yourlabsRegistry.guid&&($.fn.yourlabsRegistry.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})});var c="data-yourlabs-"+a+"-registry-id",d=this.attr(c);void 0==d&&(d=$.fn.yourlabsRegistry.guid(),
this.attr(c,d));void 0!=b&&($.fn.yourlabsRegistry.data[d]=b);return $.fn.yourlabsRegistry.data[d]};yourlabs.Autocomplete=function(a){this.input=a;this.value="";this.minimumCharacters=2;this.hideAfter=500;this.url=!1;this.xhrWait=200;this.choiceSelector=".choice";this.hilightClass="hilight";this.queryVariable="q";this.data={};this.xhr=!1;this.lastData={};this.box=$('<span class="yourlabs-autocomplete"></span>')};
yourlabs.Autocomplete.prototype.initialize=function(){this.input.on("blur.autocomplete",$.proxy(this.inputBlur,this)).on("click.autocomplete",$.proxy(this.inputClick,this)).on("keypress.autocomplete",$.proxy(this.inputKeypress,this)).on("keyup.autocomplete",$.proxy(this.inputKeyup,this)).on("keydown.autocomplete",$.proxy(this.inputKeydown,this));this.box.on("mouseenter",this.choiceSelector,$.proxy(this.boxMouseenter,this)).on("mouseleave",this.choiceSelector,$.proxy(this.boxMouseleave,this)).on("click",
this.choiceSelector,$.proxy(this.boxClick,this));this.data[this.queryVariable]=""};yourlabs.Autocomplete.prototype.destroy=function(a){a.unbind("blur.autocomplete").unbind("click.autocomplete").unbind("keypress.autocomplete").unbind("keyup.autocomplete").unbind("keydown.autocomplete")};yourlabs.Autocomplete.prototype.inputBlur=function(a){window.setTimeout($.proxy(this.hide,this),this.hideAfter)};yourlabs.Autocomplete.prototype.inputClick=function(a){this.value.length>=this.minimumCharacters&&this.show()};
yourlabs.Autocomplete.prototype.boxMouseenter=function(a){var b=this.box.find("."+this.hilightClass);this.input.trigger("dehilightChoice",[b,this]);this.input.trigger("hilightChoice",[$(a.currentTarget),this])};yourlabs.Autocomplete.prototype.boxMouseleave=function(a){this.input.trigger("dehilightChoice",[this.box.find("."+this.hilightClass),this])};yourlabs.Autocomplete.prototype.boxClick=function(a){a=this.box.find("."+this.hilightClass);this.input.trigger("selectChoice",[a,this])};
yourlabs.Autocomplete.prototype.getQuery=function(){return this.input.val()};yourlabs.Autocomplete.prototype.inputKeyup=function(a){if(this.input.is(":visible"))switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.box.is(":visible"))break;var b=this.box.find("."+this.hilightClass);if(!b.length)break;a.preventDefault();a.stopPropagation();this.input.trigger("selectChoice",[b,this]);break;case 27:if(!this.box.is(":visible"))break;this.hide();break;default:this.refresh()}};
yourlabs.Autocomplete.prototype.inputKeydown=function(a){this.input.is(":visible")&&(this.suppressKeyPressRepeat=~$.inArray(a.keyCode,[40,38,9,13,27]),this.move(a))};yourlabs.Autocomplete.prototype.inputKeypress=function(a){this.input.is(":visible")&&(this.suppressKeyPressRepeat||this.move(a))};
yourlabs.Autocomplete.prototype.show=function(a){this.fixPosition();var b=0==$.trim(this.box.find(this.choiceSelector)).length;!this.hasChanged()&&!b||this.xhr?(void 0!=a&&this.box.html(a),this.box.is(":empty")?this.box.is(":visible")&&this.hide():(a=this.box.find("."+this.hilightClass),(b=this.box.find(this.choiceSelector+":first"))&&!a.length&&b.addClass(this.hilightClass),this.box.is(":visible")||this.box.css("display","block"))):this.fetch()};yourlabs.Autocomplete.prototype.hide=function(){this.box.hide()};
yourlabs.Autocomplete.prototype.move=function(a){if(this.value.length<this.minimumCharacters)return!0;var b=this.box.find("."+this.hilightClass);-1<$.inArray(a.keyCode,[9,13])&&b.length&&a.preventDefault();if(38!=a.keyCode||a.shiftKey)if(40==a.keyCode)c="down";else return;else var c="up";var d=this.box.find(this.choiceSelector+":first"),e=this.box.find(this.choiceSelector+":last");this.show();b.length?("up"==c?(c=b.prevAll(this.choiceSelector+":first"),c.length||(c=e)):(c=b.nextAll(this.choiceSelector+
":first"),c.length||(c=d)),this.input.trigger("dehilightChoice",[b,this])):c="up"==c?e:d;a.preventDefault();this.input.trigger("hilightChoice",[c,this])};yourlabs.Autocomplete.prototype.fixPosition=function(){var a=$.extend({},this.input.position(),{height:this.input.outerHeight()});this.input.parents().filter(function(){return"hidden"===$(this).css("overflow")}).first().css("overflow","visible").addClass("autocomplete-light-clearfix");this.box.insertAfter(this.input).css({top:a.top+a.height,left:a.left})};
yourlabs.Autocomplete.prototype.refresh=function(){this.value=this.getQuery();this.value.length<this.minimumCharacters?this.hide():this.fetch()};yourlabs.Autocomplete.prototype.hasChanged=function(){for(var a in this.data)if(!a in this.lastData||this.data[a]!=this.lastData[a])return!0;return!1};
yourlabs.Autocomplete.prototype.fetch=function(){this.data[this.queryVariable]=this.value;if(this.hasChanged()){this.lastData={};for(var a in this.data)this.lastData[a]=this.data[a];this.xhr&&this.xhr.abort();this.timeoutId&&clearTimeout(this.timeoutId);this.timeoutId=setTimeout($.proxy(this.makeXhr,this),this.xhrWait)}else this.show()};
yourlabs.Autocomplete.prototype.makeXhr=function(){this.input.addClass("xhr-pending");this.xhr=$.ajax(this.url,{type:"GET",data:this.data,complete:$.proxy(this.fetchComplete,this)})};yourlabs.Autocomplete.prototype.fetchComplete=function(a,b){this.input.removeClass("xhr-pending");this.xhr==a&&(this.xhr=!1);"abort"!=b&&this.show(a.responseText)};
$.fn.yourlabsAutocomplete=function(a){if(!(1>this.length)){a=a?a:{};var b=this.yourlabsRegistry("autocomplete");if("destroy"==a)b&&(b.destroy(this),this.removeData("autocomplete"));else{this.attr("autocomplete","off");if(void 0==b){var b=new yourlabs.Autocomplete(this),c;for(c in this.data())if(c&&"autocomplete"==c.substr(0,12)&&"autocomplete"!=c){var d=c.replace("autocomplete",""),d=d.charAt(0).toLowerCase()+d.slice(1);b[d]=this.data(c)}b=$.extend(b,a);if(!b.url){alert("Autocomplete needs a url !");
return}this.yourlabsRegistry("autocomplete",b);b.initialize()}return b}}};$(document).ready(function(){function a(a,c,d){c.removeClass(d.hilightClass)}$(document).bind("hilightChoice",function(a,c,d){c.addClass(d.hilightClass)});$(document).bind("dehilightChoice",a);$(document).bind("selectChoice",a);$(document).bind("selectChoice",function(a,c,d){d.hide()})});