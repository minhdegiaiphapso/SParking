{% extends "admin/base.html" %}
{% block title %}
| Xuất dữ liệu lượt xe
{% endblock %}

{% block branding %}
<h1 id="site-name" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"
    xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
</h1>
{% endblock %}

{% block extrahead %}
<!--custom view style-->
<link rel="stylesheet" type="text/css" href="/static/css/page.css"/>

<!--datetimepicker-->
<link rel="stylesheet" type="text/css" href="/static/css/jquery.datetimepicker.css"/>

<!--datatable-->
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/jquery.dataTables.min.css"/>
{% endblock %}

{% block content %}
<div class="containerRPS">
    <form method="post" id="formRPS">
        {% csrf_token %}
        <div class="form-field">
            <label>Từ</label>

            <div>
                <input style="height: 30px; width: 150px;" type="text" value="{{from_time}}"
                       id="datetimepicker_start" name="from_time"/>
            </div>
        </div>

        <div class="form-field">
            <label>Đến</label>

            <div>
                <input style="height: 30px; width: 150px;" type="text"
                       value='{{to_time}}'
                       id="datetimepicker_end"
                       name="to_time"/>
            </div>
        </div>

        <div class="form-field">
            <label>&nbsp;</label> <br/>
            <button style="height: 30px; width: 150px;" class="form-field" type="submit" name="btn_export">
                Xuất dữ liệu
            </button>
        </div>
    </form>
    {% if link %}
    <a id="link_download" href="{{link}}" style="display: none"></a>
    {% endif %}
</div>


<!--script for datimepicker-->
<script src="/static/jquery/jquery.js"></script>
<script src="/static/jquery/jquery.datetimepicker.js"></script>
<script>
    jQuery('#datetimepicker_start').datetimepicker({
        format:'d-m-Y H:i:s',
        timepicker:true,
        lang:'vi',
        i18n:{
            vi:{
                months:[
                    'Tháng Một','Tháng Hai','Tháng Ba','Tháng Tư',
                    'Tháng Năm','Tháng Sáu','Tháng Bảy','Tháng Tám',
                    'Tháng Chín','Tháng Mười','Tháng Mười Một','Tháng Mười Hai',
                    ],
                dayOfWeek:[
                    "Chủ Nhật", "Hai", "Ba", "Tư",
                    "Năm", "Sáu", "Bảy.",
                ]
            }
        },
        onShow:function( ct ){
            this.setOptions({
                maxDate:jQuery('#datetimepicker_end').val()?jQuery('#datetimepicker_end').val():false
            })
        }
    });
    jQuery('#datetimepicker_end').datetimepicker({
        format:'d-m-Y H:i:s',
        timepicker:true,
        lang:'vi',
        i18n:{
            vi:{
                months:[
                    'Tháng Một','Tháng Hai','Tháng Ba','Tháng Tư',
                    'Tháng Năm','Tháng Sáu','Tháng Bảy','Tháng Tám',
                    'Tháng Chín','Tháng Mười','Tháng Mười Một','Tháng Mười Hai',
                    ],
                dayOfWeek:[
                    "Chủ Nhật", "Hai", "Ba", "Tư",
                    "Năm", "Sáu", "Bảy.",
                ]
            }
        },
        onShow:function( ct ){
            this.setOptions({

            })
        }
    });

</script>

{% if link %}
<script src="/static/js/spin.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('body').append('<div id="busy_indicator" style="background-color:rgba(0,0,0,0.3);width:100%;height:100%;position:fixed;top:0%;left:0%"></div>');
        var opts = {
            lines: 13, // The number of lines to draw
            length: 20, // The length of each line
            width: 10, // The line thickness
            radius: 30, // The radius of the inner circle
            corners: 1, // Corner roundness (0..1)
            rotate: 0, // The rotation offset
            direction: 1, // 1: clockwise, -1: counterclockwise
            color: '#000', // #rgb or #rrggbb or array of colors
            speed: 1, // Rounds per second
            trail: 60, // Afterglow percentage
            shadow: false, // Whether to render a shadow
            hwaccel: false, // Whether to use hardware acceleration
            className: 'spinner', // The CSS class to assign to the spinner
            zIndex: 2e9, // The z-index (defaults to 2000000000)
            top: 'auto', // Top position relative to parent in px
            left: 'auto' // Left position relative to parent in px
        };
        var target = document.getElementById('busy_indicator');
        var spinner = new Spinner(opts).spin(target);
        function check_download_ready() {
            var http = new XMLHttpRequest();
            http.open('HEAD', '{{link}}', false);
            http.send();
            if(http.status != 404) {
                $("#busy_indicator").hide();
                clearInterval(intervalId);
                document.getElementById("link_download").click();
            }
        }
        var intervalId = setInterval(check_download_ready, 1000);
        check_download_ready();
    })
</script>
{% endif %}

<link rel="stylesheet" href="/static/css/page.css">
{% endblock %}
<!--minLength: 2-->