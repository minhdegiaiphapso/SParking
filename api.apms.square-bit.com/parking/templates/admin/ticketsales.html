{% extends "admin/base.html" %}

{% block title %}
Báo cáo doanh thu vé tháng
{% endblock %}

{% block extrastyle %}
{% endblock %}

{% block branding %}
<h1 id="site-name" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html"
    xmlns="http://www.w3.org/1999/html">{{title}}</h1>
{% endblock %}

{% block extrahead %}
<!--custom view style-->
<link rel="stylesheet" type="text/css" href="/static/css/page.css"/>
<script src="/static/js/tableToExcel.js"></script>
{% endblock %}

{% block content %}
<div class="containerRPS">
    <form method="post" id="formRPS">
        {% csrf_token %}
        <div>
            <div class="form-field">
                <label>Thời gian bắt đầu</label>
                <div>
                    <input style="height: 30px; width: 150px;" type="text" value="{{start_time}}" id="datetimepicker_start" name="start_time"/>
                </div>
            </div>
            <div class="form-field">
                <label>Thời gian kết thúc</label>
                <div>
                    <input style="height: 30px; width: 150px;" type="text" value="{{end_time}}" id="datetimepicker_end" name="end_time"/>
                </div>
            </div>
            <div class="form-field">
                <label>&nbsp;</label> <br/>
                <button style="height: 30px; width: 150px;" type="submit" name="btn_submit">Tính doanh thu</button>
            </div>
            <div class="form-field">
                <label>&nbsp;</label> <br/>
                <a id="dlink"  style="display:none;"></a>
                <input style="height: 30px; width: 150px;" type="button"
                       onclick="tableToExcel('datatable', 'Thống kê',
                       '{{filename}}')"
                       value="Xuất dữ liệu">
            </div>
        </div>
    </form>

    <hr/>
    <div>
        <table id="datatable" style="width: 100%">
            <thead>
                <tr>
                    <td>BÁO CÁO DOANH THU VÉ THÁNG</td>
                </tr>
                <tr>
                    {% autoescape on %}
                    <td><a target="_blank" href="{{filter_string}}">Từ {{start_time}} đến {{end_time}}</a></td>
                    {% endautoescape %}
                </tr>
                <tr>
                    <th rowspan="">Mã lượt thanh toán</th>
                    <th rowspan="">Khách hàng</th>
                    <th rowspan="">Thanh toán lần cuối</th>
                    <th rowspan="">Số tiền</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket_payment in ticket_payments %}
                <tr>
                    <td>{{ticket_payment.id}}</td>
                    <td>{{ticket_payment.customer_name}}</td>
                    <td>{{ticket_payment.payment_date}}</td>
                    <td>{{ticket_payment.payment_fee}}</td>
                </tr>
                {% endfor %}
                <tr>
                    <th colspan="3">Tổng cộng</th>
                    <th>{{vehicle_ticket_sales}}</th>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!--style datetimepicker-->
<link rel="stylesheet" type="text/css" href="/static/css/jquery.datetimepicker.css"/>
<link rel="stylesheet" href="/static/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="/static/css/page.css">

<script src="/static/jquery/jquery.js"></script>
<script src="/static/jquery/jquery.datetimepicker.js"></script>
<script>
    jQuery('#datetimepicker_start').datetimepicker({
        format:'d-m-Y H:i',
        lang:'vi',
        i18n:{
            vi:{
                months:[
                    'Tháng Một','Tháng Hai','Tháng Ba','Tháng Tư',
                    'Tháng Năm','Tháng Sáu','Tháng Bảy','Tháng Tám',
                    'Tháng Chín','Tháng Mười','Tháng Mười Một','Tháng Mười Hai',
                    ],
                dayOfWeek:[
                    "Chủ Nhật", "Hai", "Ba", "Tư",
                    "Năm", "Sáu", "Bảy.",
                ]
            }
        },
        onShow:function( ct ){
            this.setOptions({
                maxDate:jQuery('#datetimepicker_end').val()?jQuery('#datetimepicker_end').val():false
            })
        }
    });
    jQuery('#datetimepicker_end').datetimepicker({
        format:'d-m-Y H:i',
        lang:'vi',
        i18n:{
            vi:{
                months:[
                    'Tháng Một','Tháng Hai','Tháng Ba','Tháng Tư',
                    'Tháng Năm','Tháng Sáu','Tháng Bảy','Tháng Tám',
                    'Tháng Chín','Tháng Mười','Tháng Mười Một','Tháng Mười Hai',
                    ],
                dayOfWeek:[
                    "Chủ Nhật", "Hai", "Ba", "Tư",
                    "Năm", "Sáu", "Bảy.",
                ]
            }
        },
        onShow:function( ct ){
            this.setOptions({

            })
        }
    });
</script>

<script src="https://code.jquery.com/jquery.js"></script>
<script type="text/javascript" src="/static/js/stupidtable.min.js"></script>
<script>
    $(document).ready(function () {
    $("#datatable").stupidtable();
});
</script>

<link rel="stylesheet" href="/static/css/1.8.18/jquery-ui.css" type="text/css" media="all"/>
<script src="/static/jquery/jquery.min.js" type="text/javascript"></script>
<script src="/static/jquery/1.8.16/jquery-ui.min.js" type="text/javascript"></script>
<script>
    var $j = jQuery.noConflict();
    $j(function() {
        $j("#txt_user").autocomplete({
            source: "/admin/get_users",
            minLength: 2
            });
        });
</script>
{% endblock %}